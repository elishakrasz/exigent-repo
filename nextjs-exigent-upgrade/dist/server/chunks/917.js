"use strict";exports.id=917,exports.ids=[917],exports.modules={16917:(e,a,t)=>{t.r(a),t.d(a,{default:()=>u});var n=t(77353),o=t(46242);let s=(0,o.createServerReference)("92ac37075f28a05c29f63ef02d9c264fdd56a5e8",o.callServer,void 0,o.findSourceMapURL,"setPerspectiveCookie");var i=t(35047),r=t(17266),l=t(98820),c=t(1787);let d={"handshake/syn":n.bK,"handshake/syn-ack":n.Ol,"handshake/ack":n.ei,"channel/response":n.Ag,"channel/heartbeat":n.UE,"channel/disconnect":n.Hq,"overlay/focus":"visual-editing/focus","overlay/navigate":"visual-editing/navigate","overlay/toggle":"visual-editing/toggle","presentation/toggleOverlay":"presentation/toggle-overlay"},v={[n.bK]:"handshake/syn",[n.Ol]:"handshake/syn-ack",[n.ei]:"handshake/ack",[n.Ag]:"channel/response",[n.UE]:"channel/heartbeat",[n.Hq]:"channel/disconnect","visual-editing/focus":"overlay/focus","visual-editing/navigate":"overlay/navigate","visual-editing/toggle":"overlay/toggle","presentation/toggle-overlay":"presentation/toggleOverlay"},p=e=>{let{data:a}=e;return a&&"object"==typeof a&&"domain"in a&&"type"in a&&"from"in a&&"to"in a&&("sanity/channels"===a.domain&&(a.domain=n.yK),"overlays"===a.to&&(a.to="visual-editing"),"overlays"===a.from&&(a.from="visual-editing"),a.type=d[a.type]??a.type),e},y=e=>(e.domain===n.yK&&(e.domain="sanity/channels"),"visual-editing"===e.to&&(e.to="overlays"),"visual-editing"===e.from&&(e.from="overlays"),e.type=v[e.type]??e.type,"channel/response"===e.type&&e.responseTo&&!e.data&&(e.data={responseTo:e.responseTo}),("handshake/syn"===e.type||"handshake/syn-ack"===e.type||"handshake/ack"===e.type)&&(e.data={id:e.connectionId}),e),g=({context:e},a)=>{let{sources:t,targetOrigin:n}=e,o=y(a.message);t.forEach(e=>{e.postMessage(o,{targetOrigin:n})})},h=()=>({listen:(0,n.F8)(p),requestMachine:(0,n.lB)().provide({actions:{"send message":g}})});function u(e){let{draftModeEnabled:a,draftModePerspective:t}=e,o=(0,i.useRouter)(),d=(0,l.i)((e,n)=>{a&&e!==t&&s(e).then(()=>{n.aborted||o.refresh()}).catch(e=>console.error("Failed to set the preview perspective cookie",e))});return(0,r.useEffect)(()=>{let e;let a=(0,n.dS)({name:"loaders",connectTo:"presentation"},(0,n.zB)().provide({actors:h()}));a.on("loader/perspective",a=>{e?.abort(),e=new AbortController,d(a.perspective,e.signal)});let t=a.start();return(0,c.re)(a),()=>{t()}},[d]),null}u.displayName="PresentationComlink"}};