"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[71],{97071:(e,a,n)=>{n.r(a),n.d(a,{default:()=>u});var t=n(61717),o=n(58064);let s=(0,o.createServerReference)("92ac37075f28a05c29f63ef02d9c264fdd56a5e8",o.callServer,void 0,o.findSourceMapURL,"setPerspectiveCookie");var i=n(16463),r=n(2265),l=n(62607),c=n(8675);let d={"handshake/syn":t.bK,"handshake/syn-ack":t.Ol,"handshake/ack":t.ei,"channel/response":t.Ag,"channel/heartbeat":t.UE,"channel/disconnect":t.Hq,"overlay/focus":"visual-editing/focus","overlay/navigate":"visual-editing/navigate","overlay/toggle":"visual-editing/toggle","presentation/toggleOverlay":"presentation/toggle-overlay"},v={[t.bK]:"handshake/syn",[t.Ol]:"handshake/syn-ack",[t.ei]:"handshake/ack",[t.Ag]:"channel/response",[t.UE]:"channel/heartbeat",[t.Hq]:"channel/disconnect","visual-editing/focus":"overlay/focus","visual-editing/navigate":"overlay/navigate","visual-editing/toggle":"overlay/toggle","presentation/toggle-overlay":"presentation/toggleOverlay"},p=e=>{let{data:a}=e;return a&&"object"==typeof a&&"domain"in a&&"type"in a&&"from"in a&&"to"in a&&("sanity/channels"===a.domain&&(a.domain=t.yK),"overlays"===a.to&&(a.to="visual-editing"),"overlays"===a.from&&(a.from="visual-editing"),a.type=d[a.type]??a.type),e},h=e=>(e.domain===t.yK&&(e.domain="sanity/channels"),"visual-editing"===e.to&&(e.to="overlays"),"visual-editing"===e.from&&(e.from="overlays"),e.type=v[e.type]??e.type,"channel/response"===e.type&&e.responseTo&&!e.data&&(e.data={responseTo:e.responseTo}),("handshake/syn"===e.type||"handshake/syn-ack"===e.type||"handshake/ack"===e.type)&&(e.data={id:e.connectionId}),e),y=({context:e},a)=>{let{sources:n,targetOrigin:t}=e,o=h(a.message);n.forEach(e=>{e.postMessage(o,{targetOrigin:t})})},g=()=>({listen:(0,t.F8)(p),requestMachine:(0,t.lB)().provide({actions:{"send message":y}})});function u(e){let{draftModeEnabled:a,draftModePerspective:n}=e,o=(0,i.useRouter)(),d=(0,l.i)((e,t)=>{a&&e!==n&&s(e).then(()=>{t.aborted||o.refresh()}).catch(e=>console.error("Failed to set the preview perspective cookie",e))});return(0,r.useEffect)(()=>{let e;let a=(0,t.dS)({name:"loaders",connectTo:"presentation"},(0,t.zB)().provide({actors:g()}));a.on("loader/perspective",a=>{e?.abort(),e=new AbortController,d(a.perspective,e.signal)});let n=a.start();return(0,c.re)(a),()=>{n()}},[d]),null}u.displayName="PresentationComlink"}}]);